import{I as _,J as oe,w as z,r as k,y as te,h as R,a as r,T as N,S as j,i as K,v as $,s as T,B as ne,L as ae,F as se,m as le,x as re,D as ce}from"./index-C_Q8Tcmt.js";import{t as m,f as F,n as S,a as ie,a6 as ue,q as H,u as M,k as A,y as de,i as G,c as U,w as Y,v as g,H as fe,I as ve,a7 as ye}from"./index-BWVXH31t.js";import{a as me,u as Ie}from"./use-touch-BsIB0Hnx.js";import{c as he}from"./interceptor-Dt6I5zSm.js";let Oe=2e3;const Ce=()=>++Oe,Z={show:Boolean,zIndex:S,overlay:m,duration:S,teleport:[String,Object],lockScroll:m,lazyRender:m,beforeClose:Function,overlayProps:Object,overlayStyle:Object,overlayClass:F,transitionAppear:Boolean,closeOnClickOverlay:m},Ee=Object.keys(Z);let h=0;const D="van-overflow-hidden";function Pe(e,o){const n=me(),c="01",s="10",l=u=>{n.move(u);const y=n.deltaY.value>0?s:c,b=ue(u.target,e.value),{scrollHeight:I,offsetHeight:C,scrollTop:P}=b;let d="11";P===0?d=C>=I?"00":"01":P+C>=I&&(d="10"),d!=="11"&&n.isVertical()&&!(parseInt(d,2)&parseInt(y,2))&&H(u,!0)},i=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",l,{passive:!1}),h||document.body.classList.add(D),h++},a=()=>{h&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",l),h--,h||document.body.classList.remove(D))},v=()=>o()&&i(),O=()=>o()&&a();ie(v),_(O),oe(O),z(o,u=>{u?i():a()})}function V(e){const o=k(!1);return z(e,n=>{n&&(o.value=n)},{immediate:!0}),n=>()=>o.value?n():null}const E=()=>{var e;const{scopeId:o}=((e=te())==null?void 0:e.vnode)||{};return o?{[o]:""}:null},[we,ke]=U("overlay"),Se={show:Boolean,zIndex:S,duration:S,className:F,lockScroll:m,lazyRender:m,customStyle:Object,teleport:[String,Object]};var be=R({name:we,inheritAttrs:!1,props:Se,setup(e,{attrs:o,slots:n}){const c=k(),s=V(()=>e.show||!e.lazyRender),l=a=>{e.lockScroll&&H(a,!0)},i=s(()=>{var a;const v=A(de(e.zIndex),e.customStyle);return G(e.duration)&&(v.animationDuration=`${e.duration}s`),K(r("div",T({ref:c,style:v,class:[ke(),e.className]},o),[(a=n.default)==null?void 0:a.call(n)]),[[$,e.show]])});return M("touchmove",l,{target:c}),()=>{const a=r(N,{name:"van-fade",appear:!0},{default:i});return e.teleport?r(j,{to:e.teleport},{default:()=>[a]}):a}}});const xe=Y(be),ge=A({},Z,{round:Boolean,position:g("center"),closeIcon:g("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:g("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Te,L]=U("popup");var ze=R({name:Te,inheritAttrs:!1,props:ge,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:n,slots:c}){let s,l;const i=k(),a=k(),v=V(()=>e.show||!e.lazyRender),O=le(()=>{const t={zIndex:i.value};if(G(e.duration)){const f=e.position==="center"?"animationDuration":"transitionDuration";t[f]=`${e.duration}s`}return t}),u=()=>{s||(s=!0,i.value=e.zIndex!==void 0?+e.zIndex:Ce(),o("open"))},y=()=>{s&&he(e.beforeClose,{done(){s=!1,o("close"),o("update:show",!1)}})},b=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&y()},I=()=>{if(e.overlay){const t=A({show:e.show,class:e.overlayClass,zIndex:i.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},e.overlayProps);return r(xe,T(t,E(),{onClick:b}),{default:c["overlay-content"]})}},C=t=>{o("clickCloseIcon",t),y()},P=()=>{if(e.closeable)return r(ve,{role:"button",tabindex:0,name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),fe],classPrefix:e.iconPrefix,onClick:C},null)};let d;const q=()=>{d&&clearTimeout(d),d=setTimeout(()=>{o("opened")})},J=()=>o("closed"),W=t=>o("keydown",t),Q=v(()=>{var t;const{destroyOnClose:f,round:x,position:w,safeAreaInsetTop:X,safeAreaInsetBottom:ee,show:p}=e;if(!(!p&&f))return K(r("div",T({ref:a,style:O.value,role:"dialog",tabindex:0,class:[L({round:x,[w]:w}),{"van-safe-area-top":X,"van-safe-area-bottom":ee}],onKeydown:W},n,E()),[(t=c.default)==null?void 0:t.call(c),P()]),[[$,p]])}),B=()=>{const{position:t,transition:f,transitionAppear:x}=e,w=t==="center"?"van-fade":`van-popup-slide-${t}`;return r(N,{name:f||w,appear:x,onAfterEnter:q,onAfterLeave:J},{default:Q})};return z(()=>e.show,t=>{t&&!s&&(u(),n.tabindex===0&&re(()=>{var f;(f=a.value)==null||f.focus()})),!t&&s&&(s=!1,o("close"))}),Ie({popupRef:a}),Pe(a,()=>e.show&&e.lockScroll),M("popstate",()=>{e.closeOnPopstate&&(y(),l=!1)}),ne(()=>{e.show&&u()}),ae(()=>{l&&(o("update:show",!0),l=!1)}),_(()=>{e.show&&e.teleport&&(y(),l=!0)}),ce(ye,()=>e.show),()=>e.teleport?r(j,{to:e.teleport},{default:()=>[I(),B()]}):r(se,null,[I(),B()])}});const Le=Y(ze);export{Le as P,Ee as a,Z as p,E as u};
