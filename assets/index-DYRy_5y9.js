import{c as R,s as G,k as E,i as fe,n as L,j as ae,u as le,E as _,x as $,q as ce,H as W,t as ie,m as B,h as ve,p as X,v as he,F as ge,G as be,J as j,w as Oe}from"./index-CDxJsEB3.js";import{u as se,a as Te,L as pe}from"./use-touch-CoLEfbaL.js";import{h as Q,z as ke,a as f,r as w,m as p,w as q,x as Z,s as ye}from"./index-CYNoNFn7.js";const[xe,T,ee]=R("picker"),ue=e=>e.find(a=>!a.disabled)||e[0];function Ce(e,a){const o=e[0];if(o){if(Array.isArray(o))return"multiple";if(a.children in o)return"cascade"}return"default"}function V(e,a){a=G(a,0,e.length);for(let o=a;o<e.length;o++)if(!e[o].disabled)return o;for(let o=a-1;o>=0;o--)if(!e[o].disabled)return o;return 0}const te=(e,a,o)=>a!==void 0&&e.some(u=>u[o.value]===a);function J(e,a,o){const u=e.findIndex(v=>v[o.value]===a),c=V(e,u);return e[c]}function we(e,a,o){const u=[];let c={[a.children]:e},v=0;for(;c&&c[a.children];){const h=c[a.children],g=o.value[v];if(c=fe(g)?J(h,g,a):void 0,!c&&h.length){const r=ue(h)[a.value];c=J(h,r,a)}v++,u.push(h)}return u}function Ee(e){const{transform:a}=window.getComputedStyle(e),o=a.slice(7,a.length-1).split(", ")[5];return Number(o)}function Pe(e){return E({text:"text",value:"value",children:"children"},e)}const ne=200,oe=300,Se=15,[re,z]=R("picker-column"),me=Symbol(re);var Ie=Q({name:re,props:{value:L,fields:_(Object),options:$(),readonly:Boolean,allowHtml:Boolean,optionHeight:_(Number),swipeDuration:_(L),visibleOptionNum:_(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:o}){let u,c,v,h,g;const r=w(),b=w(),m=w(0),d=w(0),k=Te(),x=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,y=l=>{let s=V(e.options,l);const t=-s*e.optionHeight,n=()=>{s>x()-1&&(s=V(e.options,l));const i=e.options[s][e.fields.value];i!==e.value&&a("change",i)};u&&t!==m.value?g=n:n(),m.value=t},O=()=>e.readonly||!e.options.length,F=l=>{u||O()||(g=null,d.value=ne,y(l),a("clickOption",e.options[l]))},C=l=>G(Math.round(-l/e.optionHeight),0,x()-1),M=p(()=>C(m.value)),K=(l,s)=>{const t=Math.abs(l/s);l=m.value+t/.003*(l<0?-1:1);const n=C(l);d.value=+e.swipeDuration,y(n)},P=()=>{u=!1,d.value=0,g&&(g(),g=null)},U=l=>{if(!O()){if(k.start(l),u){const s=Ee(b.value);m.value=Math.min(0,s-H())}d.value=0,c=m.value,v=Date.now(),h=c,g=null}},Y=l=>{if(O())return;k.move(l),k.isVertical()&&(u=!0,ce(l,!0));const s=G(c+k.deltaY.value,-(x()*e.optionHeight),e.optionHeight),t=C(s);t!==M.value&&a("scrollInto",e.options[t]),m.value=s;const n=Date.now();n-v>oe&&(v=n,h=s)},S=()=>{if(O())return;const l=m.value-h,s=Date.now()-v;if(s<oe&&Math.abs(l)>Se){K(l,s);return}const n=C(m.value);d.value=ne,y(n),setTimeout(()=>{u=!1},0)},D=()=>{const l={height:`${e.optionHeight}px`};return e.options.map((s,t)=>{const n=s[e.fields.text],{disabled:i}=s,N=s[e.fields.value],I={role:"button",style:l,tabindex:i?-1:0,class:[z("item",{disabled:i,selected:N===e.value}),s.className],onClick:()=>F(t)},de={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:n};return f("li",I,[o.option?o.option(s,t):f("div",de,null)])})};return ae(me),se({stopMomentum:P}),ke(()=>{const l=u?Math.floor(-m.value/e.optionHeight):e.options.findIndex(n=>n[e.fields.value]===e.value),s=V(e.options,l),t=-s*e.optionHeight;u&&s<l&&P(),m.value=t}),le("touchmove",Y,{target:r}),()=>f("div",{ref:r,class:z(),onTouchstartPassive:U,onTouchend:S,onTouchcancel:S},[f("ul",{ref:b,style:{transform:`translate3d(0, ${m.value+H()}px, 0)`,transitionDuration:`${d.value}ms`,transitionProperty:d.value?"all":"none"},class:z("wrapper"),onTransitionend:P},[D()])])}});const[He]=R("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},Me=["cancel","confirm","title","toolbar"],De=Object.keys(A);var Ne=Q({name:He,props:A,emits:["confirm","cancel"],setup(e,{emit:a,slots:o}){const u=()=>{if(o.title)return o.title();if(e.title)return f("div",{class:[T("title"),"van-ellipsis"]},[e.title])},c=()=>a("cancel"),v=()=>a("confirm"),h=()=>{var r;const b=(r=e.cancelButtonText)!=null?r:ee("cancel");if(!(!o.cancel&&!b))return f("button",{type:"button",class:[T("cancel"),W],onClick:c},[o.cancel?o.cancel():b])},g=()=>{var r;const b=(r=e.confirmButtonText)!=null?r:ee("confirm");if(!(!o.confirm&&!b))return f("button",{type:"button",class:[T("confirm"),W],onClick:v},[o.confirm?o.confirm():b])};return()=>f("div",{class:T("toolbar")},[o.toolbar?o.toolbar():[h(),u(),g()]])}});const[_e]=R("picker-group"),Be=Symbol(_e);E({tabs:$(),activeTab:B(0),nextStepText:String,showToolbar:ie},A);const Ve=E({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:B(44),showToolbar:ie,swipeDuration:B(1e3),visibleOptionNum:B(6)},A),$e=E({},Ve,{columns:$(),modelValue:$(),toolbarPosition:he("top"),columnsFieldNames:Object});var Re=Q({name:xe,props:$e,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:o}){const u=w(),c=w(e.modelValue.slice(0)),{parent:v}=ae(Be),{children:h,linkChildren:g}=ve(me);g();const r=p(()=>Pe(e.columnsFieldNames)),b=p(()=>be(e.optionHeight)),m=p(()=>Ce(e.columns,r.value)),d=p(()=>{const{columns:t}=e;switch(m.value){case"multiple":return t;case"cascade":return we(t,r.value,c);default:return[t]}}),k=p(()=>d.value.some(t=>t.length)),x=p(()=>d.value.map((t,n)=>J(t,c.value[n],r.value))),H=p(()=>d.value.map((t,n)=>t.findIndex(i=>i[r.value.value]===c.value[n]))),y=(t,n)=>{if(c.value[t]!==n){const i=c.value.slice(0);i[t]=n,c.value=i}},O=()=>({selectedValues:c.value.slice(0),selectedOptions:x.value,selectedIndexes:H.value}),F=(t,n)=>{y(n,t),m.value==="cascade"&&c.value.forEach((i,N)=>{const I=d.value[N];te(I,i,r.value)||y(N,I.length?I[0][r.value.value]:void 0)}),Z(()=>{a("change",E({columnIndex:n},O()))})},C=(t,n)=>{const i={columnIndex:n,currentOption:t};a("clickOption",E(O(),i)),a("scrollInto",i)},M=()=>{h.forEach(n=>n.stopMomentum());const t=O();return Z(()=>{const n=O();a("confirm",n)}),t},K=()=>a("cancel",O()),P=()=>d.value.map((t,n)=>f(Ie,{value:c.value[n],fields:r.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:i=>F(i,n),onClickOption:i=>C(i,n),onScrollInto:i=>{a("scrollInto",{currentOption:i,columnIndex:n})}},{option:o.option})),U=t=>{if(k.value){const n={height:`${b.value}px`},i={backgroundSize:`100% ${(t-b.value)/2}px`};return[f("div",{class:T("mask"),style:i},null),f("div",{class:[ge,T("frame")],style:n},null)]}},Y=()=>{const t=b.value*+e.visibleOptionNum,n={height:`${t}px`};return!e.loading&&!k.value&&o.empty?o.empty():f("div",{ref:u,class:T("columns"),style:n},[P(),U(t)])},S=()=>{if(e.showToolbar&&!v)return f(Ne,ye(X(e,De),{onConfirm:M,onCancel:K}),X(o,Me))},D=t=>{t.forEach((n,i)=>{n.length&&!te(n,c.value[i],r.value)&&y(i,ue(n)[r.value.value])})};q(d,t=>D(t),{immediate:!0});let l;return q(()=>e.modelValue,t=>{!j(t,c.value)&&!j(t,l)&&(c.value=t.slice(0),l=t.slice(0)),e.modelValue.length===0&&D(d.value)},{deep:!0}),q(c,t=>{j(t,e.modelValue)||(l=t.slice(0),a("update:modelValue",l))},{immediate:!0}),le("touchmove",ce,{target:u}),se({confirm:M,getSelectedOptions:()=>x.value}),()=>{var t,n;return f("div",{class:T()},[e.toolbarPosition==="top"?S():null,e.loading?f(pe,{class:T("loading")},null):null,(t=o["columns-top"])==null?void 0:t.call(o),Y(),(n=o["columns-bottom"])==null?void 0:n.call(o),e.toolbarPosition==="bottom"?S():null])}}});const Ue=Oe(Re);export{Ue as P};
